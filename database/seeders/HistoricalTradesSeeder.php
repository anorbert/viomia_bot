<?php

namespace Database\Seeders;

use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\DB;
use Carbon\Carbon;


class HistoricalTradesSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        $rows = [
            // NO, ticket, date (d/m/Y), opening_time, type, closing_time, time_spent, session, symbol, volume, entry_price, exit_price, pips, pl_usd, cumulative
            [1, '1331342737', '10/12/2025', '19:15:02', 'Buy', '21:02:59', '1h 47m', 'NY', 'XAUUSD', 1, 4200.18, 4200.18, 0, 0, 0],
            [2, '1332078867', '10/12/2025', '22:45:12', 'Buy', '23:06:29', '21m', 'NY', 'XAUUSD', 1, 4233.23, 4226.34, -68.9, -689, -689],
            [3, '1332129637', '10/12/2025', '23:10:13', 'Buy', '02:14:23', '3h 4m', 'Asia', 'XAUUSD', 1, 4227.86, 4242.86, 150, 1500, 811],
            [4, '1332311387', '11/12/2025', '02:40:10', 'Buy', '02:51:50', '11m', 'Asia', 'XAUUSD', 1.5, 4242.52, 4237.52, -50, -750, 61],
            [5, '1332359118', '11/12/2025', '03:05:13', 'Buy', '03:30:58', '25m', 'Asia', 'XAUUSD', 1, 4243.7, 4234.53, -91.7, -917, -856],
            [6, '1332431630', '11/12/2025', '03:40:14', 'Buy', '04:11:13', '31m', 'Asia', 'XAUUSD', 1, 4236.69, 4231.69, -50, -500, -1356],
            [7, '1332511622', '11/12/2025', '04:30:05', 'Buy', '04:35:10', '5m', 'Asia', 'XAUUSD', 1, 4230.62, 4225.62, -50, -500, -1856],
            [8, '1332801907', '11/12/2025', '07:25:08', 'Buy', '07:39:21', '14m', 'London', 'XAUUSD', 1, 4213.1, 4208.1, -50, -500, -2356],
            [9, '1333641825', '11/12/2025', '14:25:02', 'Sell', '15:00:54', '36m', 'NY', 'XAUUSD', 1, 4217.45, 4222.45, -50, -500, -2856],
            [10, '1334284235', '11/12/2025', '17:05:02', 'Buy', '17:51:36', '46m', 'NY', 'XAUUSD', 1, 4234.87, 4260.01, 251.4, 2514, -342],
            [11, '1335346715', '12/12/2025', '02:05:09', 'Buy', '02:54:33', '49m', 'Asia', 'XAUUSD', 1, 4274.79, 4269.79, -50, -500, -842],
            [12, '1335946077', '12/12/2025', '09:30:12', 'Buy', '10:42:36', '1h 12m', 'London', 'XAUUSD', 1, 4286.13, 4301.13, 150, 1500, 658],
            [13, '1336279559', '12/12/2025', '11:45:01', 'Buy', '12:44:35', '59m', 'London', 'XAUUSD', 1.5, 4312.1, 4327.49, 153.9, 2308.5, 2966],
            [14, '1336557668', '12/12/2025', '13:44:50', 'Buy', '14:49:19', '1h 5m', 'London', 'XAUUSD', 1.5, 4335.08, 4325.17, -99.1, -1486.5, 1479.5],
            [15, '1336938532', '12/12/2025', '16:00:10', 'Buy', '16:35:12', '35m', 'NY', 'XAUUSD', 1.5, 4341.39, 4332.05, -93.4, -1401, 78.5],
            [16, '1337684701', '12/12/2025', '18:35:09', 'Buy', '18:37:50', '3m', 'NY', 'XAUUSD', 1, 4281.78, 4271.95, -98.3, -983, -904.5],
            [17, '1340033990', '15/12/2025', '05:40:04', 'Buy', '15:59:42', '10h 19m', 'Asia/NY', 'XAUUSD', 1, 4327.08, 4342.33, 152.5, 1525.13, 463.13],
            [18, '1343289172', '16/12/2025', '06:10:15', 'Sell', '07:09:10', '59m', 'Asia', 'XAUUSD', 1.5, 4287.51, 4292.51, -50, -750, -286.87],
            [19, '1343738753', '16/12/2025', '10:10:16', 'Sell', '14:06:58', '3h 56m', 'London', 'XAUUSD', 1, 4282.24, 4282.24, 0, 0, -286.87],
            [20, '1344470946', '16/12/2025', '15:30:08', 'Sell', '15:31:30', '1m', 'NY', 'XAUUSD', 1, 4306.07, 4311.07, -50, -500, -786.87],
            [21, '1345695871', '16/12/2025', '22:03:00', 'Buy', '22:52:57', '49m', 'Asia', 'XAUUSD', 1, 4311.11, 4304, -71.1, -711, -1497.87],
            [22, '1346401958', '17/12/2025', '07:15:03', 'Sell', '07:23:34', '8m', 'London', 'XAUUSD', 1, 4332.59, 4337.59, -50, -500, -1997.87],
            [23, '1346828158', '17/12/2025', '10:15:11', 'Sell', '10:51:12', '36m', 'London', 'XAUUSD', 1, 4313.65, 4321.08, -74.3, -743, -2740.87],
            [24, '1347174594', '17/12/2025', '12:55:06', 'Sell', '14:20:32', '1h 25m', 'London', 'XAUUSD', 1, 4316.25, 4322.34, -60.9, -609, -3349.87],
            [25, '1348056512', '17/12/2025', '17:10:13', 'Buy', '17:19:11', '9m', 'NY', 'XAUUSD', 1, 4341.64, 4334.79, -68.5, -685, -4034.87],
            [26, '1348454248', '17/12/2025', '18:40:14', 'Buy', '20:00:44', '1h 20m', 'NY', 'XAUUSD', 1, 4326.48, 4341.96, 154.8, 1547.83, -2487.04],
            [27, '1348842977', '17/12/2025', '21:05:03', 'Buy', '01:10:06', '4h 5m', 'NY/Asia', 'XAUUSD', 1, 4336.95, 4336.95, 0, 0, -2487.04],
            [28, '1349181243', '18/12/2025', '02:15:12', 'Buy', '02:49:59', '34m', 'Asia', 'XAUUSD', 1, 4339.5, 4334.5, -50, -500, -2987.04],
            [29, '1349597710', '18/12/2025', '07:05:10', 'Buy', '10:04:39', '2h 59m', 'London', 'XAUUSD', 1, 4333.92, 4328.35, -55.7, -557, -3544.04],
            [30, '1350351108', '18/12/2025', '13:45:02', 'Buy', '14:06:49', '21m', 'London', 'XAUUSD', 1, 4326.86, 4321.86, -50, -500, -4044.04],
            [31, '1350636097', '18/12/2025', '15:25:11', 'Buy', '15:41:02', '16m', 'London', 'XAUUSD', 1, 4319.92, 4335.72, 158, 1580.25, -2463.79],
            [32, '1351100837', '18/12/2025', '16:45:05', 'Buy', '16:56:03', '11m', 'London', 'XAUUSD', 1, 4312.85, 4327.54, 146.9, 1469, -994.79],
            [33, '1352224774', '18/12/2025', '23:00:15', 'Buy', '23:36:33', '36m', 'NY', 'XAUUSD', 1, 4334.42, 4329.42, -50, -500, -1494.79],
            [34, '1352398523', '19/12/2025', '02:55:11', 'Sell', '03:28:23', '33m', 'Asia', 'XAUUSD', 1, 4330.09, 4315.09, 150, 1500, 5.21],
            [35, '1352560782', '19/12/2025', '04:30:05', 'Sell', '07:32:31', '3h 2m', 'Asia/London', 'XAUUSD', 1, 4325.22, 4325.22, 0, 0, 5.21],
            [36, '1352966040', '19/12/2025', '09:05:10', 'Buy', '12:31:01', '3h 26m', 'London', 'XAUUSD', 1, 4325.29, 4325.29, 0, 0, 5.21],
            [37, '1353488975', '19/12/2025', '13:40:14', 'Sell', '15:06:49', '1h 26m', 'London', 'XAUUSD', 1, 4326.24, 4331.24, -50, -500, -494.79],
            [38, '1354451803', '19/12/2025', '18:35:10', 'Buy', '20:41:36', '2h 6m', 'NY', 'XAUUSD', 1, 4346.5, 4346.5, 0, 0, -494.79],
            [39, '1357741678', '22/12/2025', '11:10:11', 'Buy', '15:24:19', '4h 14m', 'London', 'XAUUSD', 1, 4411.51, 4425.4, 138.9, 1389.32, 643.83],
            [40, '1359328280', '22/12/2025', '20:05:10', 'Buy', '20:45:37', '40m', 'London', 'XAUUSD', 1.5, 4437.14, 4431.86, -52.8, -792, -148.17],
            [41, '1359695188', '22/12/2025', '23:20:12', 'Buy', '02:19:49', '2h 59m', 'London/Asia', 'XAUUSD', 1, 4443.45, 4458.67, 152.2, 1521.62, 1373.45],
            [42, '1361414052', '23/12/2025', '09:50:15', 'Buy', '11:08:32', '1h 18m', 'London', 'XAUUSD', 1.5, 4488.43, 4483.41, -50.2, -753, 620.45],
            [43, '1361832424', '23/12/2025', '12:10:09', 'Buy', '14:20:47', '2h 10m', 'London', 'XAUUSD', 1.5, 4483.48, 4483.48, 0, 0, 620.45],
            [44, '1364077990', '23/12/2025', '20:45:11', 'Buy', '21:03:14', '18m', 'NY', 'XAUUSD', 1.5, 4477.04, 4492.04, 150, 2250, 2870.45],
            [45, '1365062723', '24/12/2025', '03:45:09', 'Buy', '04:01:31', '16m', 'Asia', 'XAUUSD', 1.5, 4521.85, 4516.88, -49.7, -745.5, 2124.95],
            [46, '1370306042', '26/12/2025', '07:00:15', 'Buy', '08:55:00', '1h 55m', 'London', 'XAUUSD', 1.5, 4509.19, 4509.19, 0, 0, 2124.95],
            [47, '1372454569', '26/12/2025', '16:55:14', 'Buy', '17:30:05', '35m', 'London', 'XAUUSD', 1.5, 4518.87, 4533.87, 150, 2250, 4374.95],
            [48, '1373798357', '26/12/2025', '22:05:05', 'Buy', '23:50:12', '1h 45m', 'London/Asia', 'XAUUSD', 1.5, 4531.98, 4532.52, 5.4, 81, 4455.95],
            [49, '1376659323', '29/12/2025', '10:15:08', 'Sell', '10:16:36', '1m', 'London', 'XAUUSD', 1.5, 4481.65, 4486.65, -50, -750, 3705.95],
            [50, '1376876466', '29/12/2025', '11:25:03', 'Sell', '11:43:50', '18m', 'London', 'XAUUSD', 1.5, 4463.7, 4469.06, -53.6, -804, 2901.95],
            [51, '1377128336', '29/12/2025', '13:00:16', 'Sell', '13:20:13', '20m', 'London', 'XAUUSD', 1.5, 4460.35, 4465.35, -50, -750, 2151.95],
            [52, '1378640293', '29/12/2025', '18:45:04', 'Sell', '18:54:03', '9m', 'London', 'XAUUSD', 1.5, 4335.84, 4342.83, -69.9, -1048.5, 1103.45],
            [53, '1379370048', '30/12/2025', '02:25:08', 'Sell', '02:27:01', '2m', 'Asia', 'XAUUSD', 1.5, 4345.28, 4350.28, -50, -750, 353.45],
            [54, '1379570558', '30/12/2025', '04:05:02', 'Sell', '04:39:57', '34m', 'Asia', 'XAUUSD', 1.5, 4356.9, 4356.9, 0, 0, 353.45],
            [55, '1380025964', '30/12/2025', '07:50:14', 'Sell', '08:36:14', '46m', 'London', 'XAUUSD', 1.5, 4378.45, 4363.45, 150, 2250, 2603.45],
            [56, '1380330215', '30/12/2025', '09:45:12', 'Sell', '09:49:48', '4m', 'London', 'XAUUSD', 1.5, 4377.09, 4381.97, -48.8, -732, 1871.45],
            [57, '1380552087', '30/12/2025', '10:50:17', 'Sell', '10:56:48', '6m', 'London', 'XAUUSD', 1.5, 4360.13, 4365.13, -50, -750, 1121.45],
            [58, '1380939376', '30/12/2025', '13:15:12', 'Sell', '14:11:43', '56m', 'London', 'XAUUSD', 1.5, 4387.53, 4392.53, -50, -750, 371.45],
            [59, '1381335501', '30/12/2025', '15:20:14', 'Sell', '15:38:08', '17m', 'London', 'XAUUSD', 1.5, 4393.25, 4382.81, 104.4, 1565.25, 1936.7],
            [60, '1382058732', '30/12/2025', '17:50:04', 'Sell', '18:18:03', '28m', 'London', 'XAUUSD', 1.5, 4365.61, 4365.61, 0, 0, 1936.7],
            [61, '1382356445', '30/12/2025', '19:20:02', 'Sell', '20:03:50', '43m', 'London', 'XAUUSD', 1.5, 4373.42, 4373.42, 0, 0, 1936.7],
            [62, '1382657876', '30/12/2025', '21:25:09', 'Sell', '21:48:57', '23m', 'London', 'XAUUSD', 1.5, 4366.87, 4351.87, 150, 2250, 4186.7],
            [63, '1382921771', '30/12/2025', '23:15:08', 'Sell', '02:03:28', '2h 48m', 'London/NY', 'XAUUSD', 1.5, 4348.63, 4332.98, 156.5, 2347.33, 6534.03],
            [64, '1383242202', '31/12/2025', '03:05:12', 'Sell', '03:07:31', '2m', 'Asia', 'XAUUSD', 1.5, 4346.78, 4351.78, -50, -750, 5784.03],
        ];

        foreach ($rows as $r) {
            list($no, $ticket, $date, $openTime, $type, $closeTime, $timeSpent, $session, $symbol, $volume, $entryPrice, $exitPrice, $pips, $plUsd, $cumulative) = $r;

            $typeLower = strtolower($type);

            // Parse created_at from date + opening time (format d/m/Y H:i:s)
            try {
                $createdAt = Carbon::createFromFormat('d/m/Y H:i:s', $date . ' ' . $openTime);
            } catch (\Exception $e) {
                $createdAt = Carbon::now();
            }

            // Determine SL and TP according to your rule
            $signalSl = null;
            $signalTp = null;
            $logSl = null;
            $logTp = null;

            if ($plUsd > 0) {
                // profitable: TP = exit price, SL = entry price
                $signalTp = $exitPrice;
                $signalSl = $entryPrice;
                $logTp = $exitPrice;
                $logSl = $entryPrice;
            } elseif ($plUsd < 0) {
                // loss: SL = exit price, TP = entry price
                $signalSl = $exitPrice;
                $signalTp = $entryPrice;
                $logSl = $exitPrice;
                $logTp = $entryPrice;
            } else {
                // break-even: leave null (or set both to entry if you prefer)
                $signalSl = $exitPrice;
                $signalTp = $exitPrice;
                $logSl = $exitPrice;
                $logTp = $exitPrice;
            }

            // Insert into trade_logs
            DB::table('trade_logs')->insert([
                'ticket' => $ticket,
                'symbol' => $symbol,
                'type' => $typeLower,
                'lots' => $volume,
                'sl' => $logSl,
                'tp' => $logTp,
                'open_price' => $entryPrice,
                'close_price' => $exitPrice,
                'profit' => $plUsd,
                'created_at' => $createdAt,
                'updated_at' => $createdAt,
            ]);

            // Insert into signals if not exists
            $exists = DB::table('signals')->where('ticket', $ticket)->exists();
            if (! $exists) {
                DB::table('signals')->insert([
                    'symbol' => $symbol,
                    'ticket' => $ticket,
                    'direction' => $typeLower,
                    'entry' => $entryPrice,
                    'sl' => $signalSl,
                    'tp' => $signalTp,
                    'timeframe' => $session,
                    'active' => true,
                    'created_at' => $createdAt,
                    'updated_at' => $createdAt,
                ]);
            }
        }
    }
}
